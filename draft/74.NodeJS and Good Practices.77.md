# 74.NodeJS and Good Practices.77
## <a name="index"></a> 目录
- [引子](#start)
- [title1](#title1)
  - [title11](#title11)
- [参考资料](#reference)


## <a name="start"></a> 引子
发现文章 [《The Single Responsibility Principle》][url-blog-76] 是从《NodeJS and Good Practices》里面看到的，继续翻译记录。

翻译原文：[NodeJS and Good Practices][url-article-1]

## <a name="title1"></a> 正文
软件总是处于随时变化中，而有助于衡量代码质量的一个方面是改动代码的容易程度。但为什么会这样呢？

> ...如果你害怕改变某些东西，那么它显然设计得很糟糕。
>
> — Martin Fowler

![74-knife][url-local-1]

## 关注点和责任分离（Separation of concerns and responsibilities）
“将因同样原因而改变的事情集中起来。将因不同原因而改变的事情分开。”

无论是函数、类还是模块，它们都可以应用[单一责任原则和关注点分离][url-blog-76]。从架构开始，基于这些原则进行软件设计。

### 架构（Architecture）
在软件开发中，*责任*是共同致力于实现的任务，例如：在应用程序中表示产品的概念、处理网络请求、数据库中用户持久化等等。

注意到这三项责任不属于同一类别吗？这是因为它们属于不同的层次，这些层次可以划分为不同的概念。根据上述示例，“在数据库中用户持久化”涉及“用户”概念，也涉及与数据通信的层。

一般来说，与上述概念相关的架构往往分为四层：定义域（domain）、应用（application）、基础设施（infrastructure）和输入（input interfaces）。

### 定义域层
在这一层中，我们可以定义有实体和业务规则作用的单元，它们与我们的定义域有直接的关系。例如，在用户和团队的应用程序中，我们可能有一个 `User` 实体、一个 `Team` 实体和一个 `JoinTeamPolicy` 来回答用户是否能够加入给定的团队。

这是我们软件中最独立和最重要的一层，应用层可以使用它来定义*用例*。

### 应用层
应用层定义了我们应用程序的实际行为，因此负责执行定义域层中各单元之间的交互。例如，我们可以有一个 `JoinTeam` *用例*，它接收 `User` 和 `Team` 的实例并把它们传递给`JoinTeamPolicy` ；如果用户可以加入，它将持久化的责任委托给基础设施层。

应用层还可以用作基础设施层的*适配器*。假设我们的应用程序可以发送电子邮件；负责与电子邮件服务器直接通信的类（让我们称它为 `MailChimpService` ）属于*基础设施层*，但实际发送电子邮件的类（`EmailService`）属于*应用层*，并且在内部使用 `MailChimpService` 。因此，我们应用程序的其余部分不知道具体实现细节——它只知道 `EmailService` 能够发送电子邮件。

### 基础设施层
这是所有层中最底层，是我们应用程序所有延伸的边界：数据库、电子邮件服务、队列引擎等。

*多层*应用程序的一个常见特性，是使用[存储库模式][url-article-2]与数据库或其它一些外部持久性服务（如API）通信。存储库对象本质上被视为集合，使用它们的层（*定义域层*和*应用层*）不需要知道底层是那种持久化技术（类似于我们的电子邮件服务示例）。

这里的想法是，存储库接口属于定义域层，而实现则属于基础设施层，即定义域只知道存储库接受的方法和参数。这使得这两个层更加灵活，即使在测试方面也是如此！由于 JavaScript 没有实现接口的概念，我们可以想象自己的接口，并基于基础设施层创建一个具体的实现。

### 输入层
这个层包含我们应用程序的所有入口，比如控制器、CLI、websockets、图形用户界面（对于桌面应用程序）等等。

它不应该对业务规则、用例、持久化技术有任何了解，甚至不应该对其它类型的逻辑有任何了解！它应该只接收用户输入（比如URL参数），将其传递给用例，最后返回响应给用户。

## NodeJS 与关注点分离
好了，在所有这些理论之后，如何将这些理论应用到 Node 应用程序？老实说，多层架构中使用的一些模式非常适合 JavaScript 世界！

### NodeJS 和 定义域层



<div align="right"><a href="#index">Back to top :arrow_up:</a></div>

## <a name="reference"></a> 参考资料
- [NodeJS and Good Practices][url-article-1]

[url-article-1]:https://blog.codeminer42.com/nodejs-and-good-practices-354e7d763626/
[url-article-2]:https://martinfowler.com/eaaCatalog/repository.html
[url-blog-76]:https://github.com/XXHolic/blog/issues/76

[url-local-1]:./images/74/knife.png

<details>
<summary>:wastebasket:</summary>

![n-poster][url-local-poster]

</details>

[url-book]:https://book.douban.com/subject/26916012/
[url-local-poster]:./images/n/poster.jpg
