# 60.Collision Detection ：Line.61
## <a name="index"></a> 目录
- [引子](#start)
- [LINE/POINT](#situation1)
- [LINE/RECTANGLE](#situation2)
- [LINE/CIRCLE](#situation3)
- [参考资料](#reference)


## <a name="start"></a> 引子
在 [Collision Detection ：Rectangle][url-blog-59] 中主要介绍了矩形相关的碰撞检测，接着来看看直线的情况。

以下示例未做兼容性检查，建议在最新的 Chrome 浏览器中查看。

## <a name="situation1"></a> LINE/POINT
这是[示例页面][url-lab-1]。

线与点的碰撞，观察下面一张图：

![60-line-point][url-local-1]

从图中可以发现，当点在线上时，到两个端点的距离之和与线的长度相同。两点之间的距离，同样使用之前用到过的勾股定理。考虑到计算的精度误差，可以设置一个误差允许范围值，这样会感觉更加自然一些。
```js
/*
 * 勾股定理计算两点间直线距离
 * point1 线的一个端点
 * point2 线的另一个端点
 */
function getLen(point1,point2) {
  const [x1,y2] = point1;
  const [x2,y2] = point1;
  const minusX = x2-x1;
  const minusY = y2-y1;
  const len = Math.sqrt(minusX*minusX + minusY*minusY);
  return len;
}

/*
 * (x1,y1) 线的一个端点
 * (x2,y2) 线的另一个端点
 * (px,py) 检测点的坐标
 */
function checkCollision({x1,y1,x2,y2,px,py}) {
  const d1 = getLen([px,py],[x2,y2]);
  const d2 = getLen([px,py],[x2,y2]);
  const lineLen = getLen([x1,y1],[x2,y2]);
  const buffer = 0.1; // 误差允许范围
  if (d1+d2 >= lineLen-buffer && d1+d2 <= lineLen+buffer) {
    return true; // 发生碰撞
  } else {
    return false; // 没有碰撞
  }
}
```

## <a name="situation2"></a> LINE/CIRCLE
这是[示例页面][url-lab-2]。



<div align="right"><a href="#index">Back to top :arrow_up:</a></div>

## <a name="reference"></a> 参考资料
- [LINE/POINT][url-article-1]
- [LINE/CIRCLE][url-article-2]
- [LINE/LINE][url-article-3]
- [LINE/RECTANGLE][url-article-4]
- [How to find a point on a line closest to another given point?][url-ques-1]


[url-ques-1]:https://math.stackexchange.com/questions/13176/how-to-find-a-point-on-a-line-closest-to-another-given-point
[url-article-1]:http://www.jeffreythompson.org/collision-detection/line-point.php
[url-article-2]:http://www.jeffreythompson.org/collision-detection/line-circle.php
[url-article-3]:http://www.jeffreythompson.org/collision-detection/line-line.php
[url-article-4]:http://www.jeffreythompson.org/collision-detection/line-rect.php
[url-blog-59]:https://github.com/XXHolic/blog/issues/60

[url-lab-1]:https://xxholic.github.io/lab/blog/60/line-point.html
[url-lab-2]:https://xxholic.github.io/lab/blog/60/line-circle.html
[url-lab-3]:https://xxholic.github.io/lab/blog/60/line-circle.html

[url-local-1]:./images/60/line-point.jpg

<details>
<summary>:wastebasket:</summary>


最近在看[《黑暗的左手》][url-book]，里面关于性的设定很有意思，在书中描述的星球上，是没有性别区分的。下面是书中部分摘录。



![60-poster][url-local-poster]

</details>

[url-book]:https://book.douban.com/subject/26916012/
[url-local-poster]:./images/60/poster.jpg
