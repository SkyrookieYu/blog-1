# 53.前端异常类型及捕捉.53
## <a name="index"></a> 目录
- [引子](#start)
- [index 1](#index1)
  - [index 12](#index12)
- [参考资料](#reference)


## <a name="start"></a> 引子
最近对着方面有了兴致，就去花时间查找相关资料。

## 异常类型
从使用浏览器，浏览一个网页，与网页进行交互的过程，从用户的角度想一想会出现那些异常。

首先是使用浏览器一般都是基于一个操作系统，系统自身可能会出现问题，比如内存不够。这类情况归为**系统异常**。

正常打开浏览器后，访问网页的时候，可能没有网络，访问的网页提示出现服务错误，等待过程中突然断网了，将这类情况归为**网络异常**。

能够正常访问网页后，用户进行交互操作时，可能出现一种情况下点击有效，一种条件下点击无效，这类情况归为**应用异常**。

在上面比较感性的认识基础上，进一步的进行细化。

### 系统异常
系统异常情况比较少，服务器系统中出现的异常，更多偏向后端，前端相关没有找到相关的资料。

### 网络异常
网络异常中，前端相关的有：
- XMLHttpRequest 请求异常
- Fetch 请求异常
- 静态资源加载异常
- iframe 异常
- 跨域

### 应用异常
应用异常可以用 JavaScript 中的错误对象体现出来：
- EvalError ： 与 eval() 有关的错误。
- RangeError ： 表示这个值不在允许值集或范围内。
- ReferenceError ： 表示发现一个无效的引用。
- SyntaxError ： 表示发生了解析错误。
- TypeError ：当其它类型错误都符合时，TypeError 用于指示一个不成功的操作。
- URIError ：表示用于处理 URI 的函数（encodeURI 或 decodeURl）使用方式与其定义的不兼容。


## 异常捕捉

### Try-Catch
只能捕获到同步的运行时错误，对语法和异步错误却无能为力，捕获不到。

try-catch 则是用来在可预见情况下监控特定的错误

### window.onerror
当 JS 运行时错误发生时，window 会触发一个 ErrorEvent 接口的 error 事件，并执行 window.onerror()。

window.onerror 函数只有在返回 true 的时候，异常才不会向上抛出，否则即使是知道异常的发生控制台还是会显示 Uncaught Error: xxxxx

- 可监听到 同步，异步运行
- 不能监听语法，静态资源异常，或者接口异常

onerror 主要是来捕获预料之外的错误

### window.addEventListener
当一项资源（如图片或脚本）加载失败，加载资源的元素会触发一个 Event 接口的 error 事件，并执行该元素上的onerror() 处理函数。这些 error 事件不会向上冒泡到 window。不过（至少在 Firefox 中）能被单一的window.addEventListener 捕获。但是无法判断 HTTP 的状态是 404 还是其他比如 500 等等，所以还需要配合服务端日志才进行排查分析才可以。

### Promise Catch、Async/Await
没有写 catch 的 Promise 中抛出的错误无法被 onerror 或 try-catch 捕获到，所以我们务必要在 Promise 中不要忘记写 catch 处理抛出的异常。

为了防止有漏掉的 Promise 异常，建议在全局增加一个对 unhandledrejection 的监听，用来全局监听Uncaught Promise Error

### React
componentDidCatch





<div align="right"><a href="#index">Back to top :arrow_up:</a></div>

## <a name="reference"></a> 参考资料
- [example][url-base]
- http://jartto.wang/2018/11/20/js-exception-handling/index.html
- https://blog.fundebug.com/2019/07/24/async-await-error-handling-in-js/
- http://thecodebarbarian.com/async-await-error-handling-in-javascript.html
- https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Error
- https://rollbar.com/blog/top-10-javascript-errors/
- https://blog.fundebug.com/2018/03/12/top-10-javascript-errors-from-1000-projects/
- https://cdc.tencent.com/2018/09/13/frontend-exception-monitor-research/

[url-base]:https://xxholic.github.io/segment