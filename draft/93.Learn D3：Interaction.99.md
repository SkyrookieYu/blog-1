# 93.Learn D3： Interaction.99

## <a name="start"></a> 引子
继 [Learn D3: Joins][url-pre] 第八篇，只是英文翻译，可修改代码的部分用静态图片替代了，想要实时交互请阅读原文。

- 原文：[Learn D3: Interaction][url-1]
- 版本：Published Mar 24, 2020

## <a name="title1"></a> 正文
几乎总是有太多的信息无法合理地“容纳”在图表中。因此，设计不仅仅是决定*如何*展示某些东西，而是根据我们认为对想象中的读者重要的东西，来决定展示*什么*和不展示什么。

多亏了计算机，*真正*的读者现在有了发言权：可以根据读者兴趣的需要定制图表。

然而，这种力量是一把双刃剑。交互性允许读者发现更多信息，但迫使读者参与互动。如果我们不小心，我们可能会将重要的见解隐藏在读者从不点击的控件后面。

如果我们的目的是传达已知的信息，我们应该在考虑交互之前设计一个有效的静态图表。另一方面，如果我们试图探索未知，那么交互可以比编码一个新的图表更快（但也考虑可视化语法探索，如 [Vega Lite][url-2] ）！

比较好的互动指南可以参考 Ben Shneiderman 的 [information-seeking mantra][url-3] ：

> Overview first,zoom and filter,then details on demand.

*overview* 是图表的初始形式。它的目的不是显示所有数据（这是不可能的），而是提供所有数据的“宏观”视图。overview 是引导读者探索的地图。

*zooming* 和 *filtering* 是选择关注感兴趣主题的内容显示的方法。我们以前看到过将图表裁剪到各个年份的控件；还有[自由缩放的形式][url-4]、[平移][url-5]和[焦点+上下文][url-6]。如果我们比较多个时间序列，我们可能需要像[多折线图示例][url-7]中那样进行过滤。另请参见[可刷散点图矩阵][url-8]。

*details on demand* 允许读者从图表中提取精确值，而不限于视觉近似值。这可以像鼠标提示一样简单。

鼠标提示的一种方法是在 SVG 中不受限制的添加标题元素。鼠标悬停（并短暂等待）查看下面某一天的苹果股价。

![93-1][url-local-1]


上图中，1260 个不可见的矩形元素垂直贯穿图表，水平横跨相邻的数据点（用 [d3.pairs][url-9] 计算）。当鼠标悬停在矩形上时，将显示子 title 元素的文本。因此，显示提示信息的是鼠标 *x* 位置的函数，最适合于 *y* 为因变量的时间序列图。

更通用的方法是 [Voronoi 覆盖][url-10]，其中距离鼠标最近的数据点确定为信息提示(为了清晰起见，下面绘制了 Voronoi 图……并且因为它看起来很酷。你通常不会显示它。）

![93-2][url-local-2]
![93-3][url-local-3]

本地鼠标提示有几个缺点：它们的显示速度较慢；移动浏览器不支持它们；而且并不总是很明显哪个数据点与提示信息关联，尤其是在使用 Voronoi 图时。

不过，再多做一点工作，我们就可以定制鼠标提示了。

![93-4][url-local-4]

这里元素的顺序很重要：SVG 不支持 *z* 顺序，因此要在直线和轴的之上绘制信息提示，它必须是最后一个。

虽然本地鼠标提示会自动显示，但自定义信息提示通常需要事件监听。当用户执行操作（例如将鼠标移到元素上）时，浏览器将调用这些函数。上面的侦听器捕获闭包中的数据（ *a* 和 *b* ），以了解在触发事件时显示什么。

（我们使用 Object.assign ，因为 Observable 的 HTML 模板文本当前不支持事件侦听器作为属性。我们更新的 [hyperscript literal][url-11] 确实支持事件侦听器，所以请考虑使用它。我们计划在不久的将来升级标准库。）

自定义信息提示在下面的类中实现。它提供了用于嵌入的 *tooltip*.node 属性（SVG g 元素），以及 *tooltip*.show 和 *tooltip*.hide 方法，以根据需要更新工具提示。这为信息提示的触发方式提供了一定的灵活性。

![93-5][url-local-5]

上面的图表使用 Observable 的 HTML 模板文本，但是我们可以用 D3 风格实现一个相同的图表。用你喜欢的！

![93-6][url-local-6]

*mouseover* 事件触发的信息提示可能代价高昂：它们要求图表的每个可悬停区域都有一个单独的元素。对于复杂的图表，你可以通过计算按需悬停的内容来提高性能。

对于一维排序的数据（例如我们这里的时间序列数据），一种特别高效的方法是在 *mousemove* 事件触发时进行二等分。

![93-7][url-local-7]

![93-9][url-local-9]

## 附录

![93-10][url-local-10]


## <a name="reference"></a> 参考资料
- [Learn D3: Interaction][url-1]

[url-pre]:https://github.com/XXHolic/blog/issues/98
[url-1]:https://observablehq.com/@d3/learn-d3-interaction?collection=@d3/learn-d3
[url-2]:https://vega.github.io/vega-lite/
[url-3]:https://www.cs.umd.edu/~ben/papers/Shneiderman1996eyes.pdfz
[url-4]:https://observablehq.com/@d3/zoomable-area-chart
[url-5]:https://observablehq.com/@d3/pannable-chart
[url-6]:https://observablehq.com/@d3/focus-context
[url-7]:https://observablehq.com/@d3/multi-line-chart
[url-8]:https://observablehq.com/@d3/brushable-scatterplot-matrix
[url-9]:https://github.com/d3/d3-array/blob/master/README.md#pairs
[url-10]:https://github.com/d3/d3-delaunay
[url-11]:https://observablehq.com/@observablehq/htl




[url-local-1]:./images/93/1.png
[url-local-2]:./images/93/2.png
[url-local-3]:./images/93/3.png
[url-local-4]:./images/93/4.png
[url-local-5]:./images/93/5.png
[url-local-6]:./images/93/6.png
[url-local-7]:./images/93/7.png
[url-local-8]:./images/93/8.png
[url-local-9]:./images/93/9.png
[url-local-10]:./images/93/10.png

<details>
<summary>:wastebasket:</summary>



</details>

[url-local-poster]:./images/93/poster.jpg
