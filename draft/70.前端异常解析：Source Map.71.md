# 70.前端异常解析：Source Map.71
## <a name="index"></a> 目录
- [引子](#start)
- [title1](#title1)
  - [title11](#title11)
- [参考资料](#reference)


## <a name="start"></a> 引子
在 [69.前端异常解析.70][url-blog-69] 中介绍了异常的解析，这些异常信息上报后，一般也难以直接的看出什么错误源，因为正式的线上环境中，代码往往都经过了压缩混淆，异常的一些信息描述的都是基于压缩文件。这时候可以根据 Source Map 文件追溯源文件的位置。

## <a name="intro"></a> 简介
最初的源映射格式是由 Joseph Schorr 创建，在 Closure Inspector（谷歌的公共工具）中使用，用来开启 JavaScript 源码级别的调试优化。随着使用了源映射的项目规模扩大，格式冗余开始成为一个问题。v2 版本为了减小源映射整体大小，牺牲了一些简单性和灵活性。即使 v2 版本对格式进行了修改，对于源映射的大小限制了它的实用性。目前最新的版本是 v3 。更多信息见 [Source Map Revision 3][url-spec-1] 。

## <a name="format"></a> 格式
按照约定，源映射跟源文件拥有相同的名称，只是后缀为 `.map` 。比如 page.js 的产生的源映射名称是 page.js.map 。这个约定并不是强制性的。

源映射整个文件是一个 JSON 对象：
```json
{
  "version" : 3,
  "file": "out.js",
  "sourceRoot": "",
  "sources": ["foo.js", "bar.js"],
  "sourcesContent": [null, null],
  "names": ["src", "maps", "are", "fun"],
  "mappings": "A,AAAB;;ABCDE;"
}
```
- version ：source map 版本，必须是一个正整数。
- file ：可选项，转换后产生的源映射文件名。
- sourceRoot ：可选项，资源更路径，在服务器上重新定位源文件和移除 `sources` 中重复的值有用处。这个值会预先添加到 `sources` 字段中每一个值。如果是跟源文件相同的路径，则为空。
- sources ：存放 `mappings` 中使用的源文件。
- sourcesContent ：可选性，存放源内容，当 sources 不能包含时有用。列表的顺序跟 `sources` 字段中顺序一致。如果一些源要按照名称检索，可能会使用 `null` 。
- names ：`mappings` 中使用的一些标识名。
- mappings ：记录了映射信息的字符串。

关于映射的原理见 [JavaScript Source Map 详解][url-article-1] 。

## <a name="analyze"></a> 解析
- 怎么检测是否有 source map 文件
- 怎么下载对应 source map 文件
- 解析的时机



<div align="right"><a href="#index">Back to top :arrow_up:</a></div>

## <a name="reference"></a> 参考资料
- [Source Map Revision 3 Proposal][url-spec-1]
- [JavaScript Source Map 详解][url-article-1]
- [source-map-support][url-github-2]
- [source-map][url-github-3]


[url-spec-1]:https://sourcemaps.info/spec.html
[url-blog-69]:https://github.com/XXHolic/blog/issues/70
[url-article-1]:http://www.ruanyifeng.com/blog/2013/01/javascript_source_map.html
[url-article-2]:https://css-tricks.com/should-i-use-source-maps-in-production/
[url-github-1]:https://github.com/bugsnag/sourcemaps.info
[url-github-2]:https://github.com/evanw/node-source-map-support
[url-github-3]:https://github.com/mozilla/source-map
[url-mdn-1]:https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/SourceMap

[url-local-rail]:./images/n/rail.png

<details>
<summary>:wastebasket:</summary>

![n-poster][url-local-poster]

</details>

[url-book]:https://book.douban.com/subject/26916012/
[url-local-poster]:./images/n/poster.jpg
