# 38.Read React ：Component
## <a name="index"></a> 目录
- [引子](#start)
- [基本概念](#concept)
- [主要实现](#achieve)
- [其它 API 实现](#other)
- [思考](#think)
- [参考资料](#reference)


## <a name="start"></a> 引子
接着 [Read Redux][url-blog37] 继续看 [React][url-github-react-redux] 源码。

查看代码版本是 v16.8.6 ，安装到本地，断点的方式进入查看。


## <a name="concept"></a> 基本概念

React 用于构建用户界面的 JavaScript 库，详细介绍见[官方文档][url-docs-react]。

## <a name="achieve"></a> 组件初始化
使用的示例没有使用 JSX 语法，这样子调用了那些方法，看起来会更加的明了一点。
```js
  class Hello extends React.Component {
    render() {
      return React.createElement("div", null, `Hello ${this.props.toWhat}`);
    }
  }

  ReactDOM.render(
    React.createElement(Hello, { toWhat: "World" }, null),
    document.getElementById("root")
  );
```
使用到的 API 有：
- React.Component
- React.createElement
- ReactDOM.render

### React.Component
react GitHub 库下 /packages/react/ 目录，在 ReactBaseClasses.js 文件中找到 Component 方法，主要的逻辑有：
```js
function Component(props, context, updater) {
  this.props = props;
  this.context = context;
  // If a component has string refs, we will assign a different object later.
  this.refs = emptyObject;
  // We initialize the default updater but the real one gets injected by the
  // renderer.
  this.updater = updater || ReactNoopUpdateQueue;
}

Component.prototype.isReactComponent = {};

Component.prototype.setState = function(partialState, callback) {
  // 代码省略
}

Component.prototype.forceUpdate = function(callback) {
  // 代码省略
};
```
Component 方法主要设置了属性和公用了方法。发现 Component 并没有 render 方法，render 方法其实是 Hello 组件自己的方法。Hello 方法继承了 Component 方法，然后传给了 React.createElement ，接下来看下进行了那些处理。

### React.createElement
react GitHub 库下 /packages/react/ 目录，在 ReactElement.js 文件中找到 createElement 方法，主要逻辑如下：
```js
export function createElement(type, config, children) {
  let propName;

  // Reserved names are extracted
  const props = {};

  let key = null;
  let ref = null;
  let self = null;
  let source = null;

  if (config != null) {
    // 对 config 的检查、取值等处理
  }

  const childrenLength = arguments.length - 2;
  if (childrenLength === 1) {
    props.children = children;
  } else if (childrenLength > 1) {
    // children 合并
  }

  if (type && type.defaultProps) {
    // defaultProps 初始化
  }

  if (__DEV__) {
    // 检查
  }

  return ReactElement(
    type,
    key,
    ref,
    self,
    source,
    ReactCurrentOwner.current,
    props,
  );
}
```
createElement 方法主要逻辑是参数的初步处理，最终都传给了 ReactElement 方法，其主要的逻辑如下：
```js
const ReactElement = function(type, key, ref, self, source, owner, props) {
  const element = {
    // This tag allows us to uniquely identify this as a React Element
    $$typeof: REACT_ELEMENT_TYPE,

    // Built-in properties that belong on the element
    type: type,
    key: key,
    ref: ref,
    props: props,

    // Record the component responsible for creating this element.
    _owner: owner,
  };

  if (__DEV__) {
    // 检查
  }

  return element;
};
```
ReactElement 方法把传入的参数重新放入到一个对象里面并返回，那么就来看下 Hello 组件处理后的结果：
```js
console.info("Hello", React.createElement(Hello, { toWhat: "World" }, null));
```
![38-hello][url-local-hello]

属性 type 指向组件 Hello ，在 Hello 的 prototype 组件里面可以发现 render 方法。createElement 返回的对象传入到了 ReactDOM.render 方法中。

### ReactDOM.render
react GitHub 库下 /packages/react-dom/ 目录






React 部分的组装了一个虚拟 dom 的一些基本属性。进入到装换为真实 DOM 的阶段。


<div align="right"><a href="#index">Back to top :arrow_up:</a></div>

## <a name="achieve"></a> setState
在执行

<div align="right"><a href="#index">Back to top :arrow_up:</a></div>

## <a name="other"></a> 其它 API 实现
下面针对其它 API 的实现介绍一下。




<div align="right"><a href="#index">Back to top :arrow_up:</a></div>

## <a name="think"></a> 思考

<div align="right"><a href="#index">Back to top :arrow_up:</a></div>


## <a name="reference"></a> 参考资料
- [React Redux Github][url-github-react-redux]
- [Redux Doc][url-docs-redux]
- [React Redux Doc][url-docs-react-redux]

[url-base]:https://xxholic.github.io/blog/draft

[url-docs-react]:https://zh-hans.reactjs.org/
[url-blog37]:https://github.com/XXHolic/blog/issues/37

[url-local-hello]:./images/38/hello.png




